<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <title>Cours JS - async/await</title>
  <style>
    * {
      font-size: auto;

    }

    body {
      font-family: 'Times New Roman', Times, serif;
      background-color: #f4f4f4;
      padding: 2em;
      line-height: 1.6;
    }

    h1,
    h2 {
      color: #333;
    }

    code {
      background: #eee;
      padding: 2px 4px;
      border-radius: 4px;
      font-family: monospace;
      color: rgb(224, 62, 3);
    }

    pre {
      background: #272822;
      color: #f8f8f2;
      padding: 1em;
      border-radius: 8px;
      overflow-x: auto;
    }

    button {
      margin-top: 10px;
      padding: 8px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #demo {
      background: white;
      padding: 1em;
      margin-top: 1em;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .italic {
      font-style: italic;
      color: #666;
    }
  </style>
</head>

<body>

  <h1>üìò Cours JavaScript : async / await</h1>

  <p>La programmation <strong>asynchrone</strong> permet √† JavaScript de continuer √† fonctionner sans √™tre bloqu√©
    pendant qu‚Äôil attend une r√©ponse (ex : d‚Äôun serveur API).</p>

  <h2>1. Pourquoi async / await ?</h2>
  <h2>1.1. Rappel rapide : qu‚Äôest-ce qu‚Äôune promesse ?</h2>
  <p>Une <strong>promesse</strong> est un objet JavaScript repr√©sentant une t√¢che asynchrone. Elle peut √™tre :</p>
  <ul>
    <li><strong>en attente</strong> (pending)</li>
    <li><strong>r√©solue</strong> (fulfilled)</li>
    <li><strong>√©chou√©e</strong> (rejected)</li>
  </ul>
  <p>On utilise <code>.then()</code> pour g√©rer les succ√®s, et <code>.catch()</code> pour g√©rer les erreurs.</p>

  <pre><code>fetch("https://animechan.vercel.app/api/random")
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error(error));
</code></pre>
  <p>Mais ce style peut vite devenir compliqu√© si on encha√Æne plusieurs actions. D‚Äôo√π l‚Äôint√©r√™t de
    <code>async/await</code>.
  </p>
  <p>Avant, on utilisait <code>.then()</code> pour cha√Æner les actions. Mais c‚Äô√©tait vite difficile √† lire.</p>

  <p><strong>Avec <code>async</code> et <code>await</code></strong>, ton code devient plus clair et plus lin√©aire.</p>

  <h2>2. Syntaxe de base</h2>
  <pre><code>async function maFonction() {
  try {
    const reponse = await fetch("https://animechan.vercel.app/api/random");
    const data = await reponse.json();
    console.log(data);
  } catch (err) {
    console.error("Erreur :", err.message);
  }
}</code></pre>

  <p><code>await</code> bloque l'ex√©cution jusqu'√† ce que la r√©ponse arrive.</p>

  <h2>3. D√©mo en direct</h2>
  <h2>2.1. Comparaison visuelle</h2>
  <p>Regarde comme la version <strong>async/await</strong> est plus lisible :</p>

  <div style="display: flex; gap: 2em; flex-wrap: wrap;">
    <div style="flex: 1; min-width: 250px;">
      <h3 style="color: darkred;">Avec .then()</h3>
      <pre><code>fetch(url)
  .then(res => res.json())
  .then(data => {
    console.log(data);
  })
  .catch(err => {
    console.error(err);
  });</code></pre>
    </div>

    <div style="flex: 1; min-width: 250px;">
      <h3 style="color: darkgreen;">Avec async/await</h3>
      <pre><code>async function maFonction() {
  try {
    const res = await fetch(url);
    const data = await res.json();
    console.log(data);
  } catch (err) {
    console.error(err);
  }
}</code></pre>
    </div>
  </div>
  <p class="italic">Clique pour obtenir une citation d'anime depuis une API</p>
  <button onclick="obtenirCitation()">Obtenir une citation</button>

  <div id="demo"></div>

  <script>
    async function obtenirCitation() {
      const demo = document.getElementById("demo");
      demo.innerHTML = "<p><em>Chargement en cours...</em></p>";

      try {
        const res = await fetch("https://animechan.vercel.app/api/random");
        const data = await res.json();

        demo.innerHTML = `
          <h3>${data.character} ‚Äî <em>${data.anime}</em></h3>
          <blockquote>"${data.quote}"</blockquote>
        `;
        const res2 = await fetch("https://animechan.vercel.app/api/random");
        const data2 = await res2.json();

        demo.innerHTML = `
          <h3>${data2.character} ‚Äî <em>${data2.anime}</em></h3>
          <blockquote>"${data2.quote}"</blockquote>
        `;
      } catch (err) {
        demo.innerHTML = `<p style="color:red;">Erreur : ${err.message}</p>`;
      }
    }
    async function obtenirCitation() {
      const demo = document.getElementById("demo");
      demo.innerHTML = "<p><em>Chargement en cours...</em></p>";

      try {
        // On r√©cup√®re les donn√©es de l'API
        const res = await fetch("https://animechan.vercel.app/api/random");

        // On attend que la r√©ponse soit convertie en JSON
        const data = await res.json();

        // On ins√®re le r√©sultat dans le HTML
        demo.innerHTML = `
      <h3>${data.character} ‚Äî <em>${data.anime}</em></h3>
      <blockquote>"${data.quote}"</blockquote>
    `;
      } catch (err) {
        // En cas d‚Äôerreur (ex : pas de connexion), on affiche un message
        demo.innerHTML = `<p style="color:red;">Erreur : ${err.message}</p>`;
      }
    }
  </script>

  <h2>4. Fonctions async fl√©ch√©es</h2>
  <p>Tu peux aussi √©crire des fonctions async avec la syntaxe fl√©ch√©e :</p>
  <pre><code>const obtenirCitation = async () => {
  try {
    const res = await fetch("https://animechan.vercel.app/api/random");
    const data = await res.json();
    console.log(data);
  } catch (err) {
    console.error("Erreur :", err.message);
  }
};</code></pre>

  <h2>5. Attendre plusieurs requ√™tes en parall√®le</h2>
  <p>Utilise <code>Promise.all()</code> pour acc√©l√©rer plusieurs requ√™tes :</p>
  <pre><code>async function chargerToutesLesCitations() {
  const urls = [
    "https://animechan.vercel.app/api/random",
    "https://animechan.vercel.app/api/random",
  ];

  try {
    const resultats = await Promise.all(
      urls.map(url => fetch(url).then(res => res.json()))
    );
    console.log(resultats);
  } catch (err) {
    console.error("Erreur :", err.message);
  }
}</code></pre>

  <h2>6. Simulation de d√©lai (temporisation)</h2>
  <button onclick="demoDelai()">Tester la temporisation</button>
  <pre><code>function attente(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function demoDelai() {
  console.log("Attente de 2 secondes...");
  await attente(2000);
  console.log("Fin de l'attente !");
}</code></pre>

  <h2>7. Attention ‚ö†Ô∏è</h2>
  <ul>
    <li><code>await</code> ne fonctionne que dans une fonction <code>async</code></li>
    <li>Tu ne peux pas l‚Äôutiliser en dehors de ce contexte</li>
  </ul>

  <h2>8. Avantages de async/await</h2>
  <ul>
    <li>Lisibilit√© naturelle du code</li>
    <li>Facile √† maintenir</li>
    <li>Compatible avec <code>try/catch</code></li>
    <li>Parfait pour les projets avec API</li>
  </ul>

  <h2>9. √Ä retenir</h2>
  <ul>
    <li><code>async</code> permet d‚Äôutiliser <code>await</code> dans une fonction</li>
    <li><code>await</code> attend que la promesse se r√©solve</li>
    <li>Utilise <code>try/catch</code> pour √©viter les plantages</li>
  </ul>
  <h2>9.1. Erreurs fr√©quentes √† √©viter</h2>
  <ul>
    <li>‚ùå Oublier d‚Äô√©crire <code>async</code> avant la fonction ‚ûú <code>await</code> ne marchera pas</li>
    <li>‚ùå Essayer d‚Äôutiliser <code>await</code> en dehors d‚Äôune fonction ‚ûú erreur de syntaxe</li>
    <li>‚ùå Ne pas g√©rer les erreurs avec <code>try/catch</code> ‚ûú plantage possible</li>
  </ul>

  <h2>9.2. Mini-FAQ ü§î</h2>
  <details>
    <summary><strong>Pourquoi faut-il attendre avec await ?</strong></summary>
    <p>Parce qu‚Äôune fonction asynchrone retourne une promesse, et on veut attendre qu‚Äôelle soit termin√©e avant de
      continuer le code.</p>
  </details>

  <details>
    <summary><strong>Est-ce que √ßa bloque le navigateur ?</strong></summary>
    <p>Non ! <code>await</code> bloque juste la fonction actuelle, pas tout le navigateur.</p>
  </details>

  <details>
    <summary><strong>Quelle diff√©rence entre async et setTimeout ?</strong></summary>
    <p><code>setTimeout</code> lance une t√¢che plus tard ; <code>await</code> attend qu'une t√¢che asynchrone se termine.
    </p>
  </details>
  <h2>10. üéØ Mini-d√©fi</h2>
  <p class="italic">üí° Modifie le script pour afficher deux citations simultan√©ment au lieu d‚Äôune seule. Utilise
    <code>Promise.all()</code> !
  </p>

</body>

</html>