<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Effet de saisie — Typing App</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#8b5cf6; --muted:#94a3b8; --text:#e6eef8;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg,#071022,#071428);
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial
    }
    .app{
      width:min(900px,95vw);
      background:linear-gradient(180deg,var(--card),#071124);
      padding:20px;
      border-radius:16px;
      box-shadow:0 8px 30px rgba(2,6,23,0.7);
      color:var(--text);
    }
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .main{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .preview{
      background:rgba(255,255,255,0.02);
      padding:18px;
      border-radius:12px;
      min-height:200px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative
    }
    .output{
      font-family: 'Courier New',monospace;
      white-space:pre-wrap;
      font-size:20px;
      line-height:1.35
    }
    .cursor{
      display:inline-block;
      width:10px;
      height:26px;
      background:var(--accent);
      vertical-align:middle;
      margin-left:6px;
      border-radius:2px;
      animation:blink 1s steps(2) infinite
    }
    @keyframes blink{50%{opacity:0}}

    .controls{display:flex;flex-direction:column;gap:10px}
    label{font-size:13px;color:var(--muted)}
    textarea{
      width:100%;
      min-height:120px;
      border-radius:8px;
      padding:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:var(--text);
      resize:vertical
    }
    .row{display:flex;gap:8px;align-items:center}
    .btn{
      background:var(--accent);
      border:none;
      color:white;
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600
    }
    .btn.ghost{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06)
    }
    input[type=range]{width:100%}
    .meta{display:flex;gap:8px;align-items:center}
    .small{font-size:12px;color:var(--muted)}
    footer{margin-top:12px;text-align:right;color:var(--muted);font-size:12px}

    @media (max-width:880px){
      .main{grid-template-columns:1fr;}
      .controls{order:2}
    }
  </style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <div>
        <h1>Effet de saisie automatique — Web App</h1>
        <p class="lead">Tapez votre texte à gauche, ajustez la vitesse et appuyez sur ▶︎</p>
      </div>
    </header>

    <div class="main">
      <div>
        <div class="preview" aria-live="polite">
          <div class="output" id="output"></div>
          <div class="cursor" id="cursor" aria-hidden="true"></div>
        </div>

        <div style="display:flex;gap:8px;margin-top:10px;">
          <button class="btn" id="play">▶︎ Play</button>
          <button class="btn ghost" id="pause">⏸ Pause</button>
          <button class="btn ghost" id="reset">⟲ Reset</button>
        </div>
      </div>

      <aside class="controls">
        <label for="inputText">Texte à afficher</label>
        <textarea id="inputText">Bonjour !
Ceci est un exemple d'effet de saisie.
Vous pouvez écrire plusieurs lignes.
Amusez-vous ✨</textarea>

        <div>
          <label class="small">Vitesse (ms par caractère)</label>
          <div class="row">
            <input type="range" id="speedRange" min="10" max="200" value="50">
            <div class="small" id="speedLabel">50 ms</div>
          </div>
        </div>

        <div>
          <label class="small">Options</label>
          <div class="meta">
            <label class="small"><input type="checkbox" id="loop"> Boucle</label>
            <label class="small"><input type="checkbox" id="showCursor" checked> Curseur</label>
          </div>
        </div>

        <div>
          <label class="small">Effets supplémentaires</label>
          <div style="display:flex;gap:8px;margin-top:6px;">
            <button class="btn ghost" id="typeOnce">Saisir une fois</button>
            <button class="btn ghost" id="erase">Effacer</button>
          </div>
        </div>
      </aside>
    </div>

    <footer>Fichier autonome — Ouvrez dans un navigateur pour tester.</footer>
  </div>

  <script>
    const output = document.getElementById('output');
    const cursor = document.getElementById('cursor');
    const inputText = document.getElementById('inputText');
    const playBtn = document.getElementById('play');
    const pauseBtn = document.getElementById('pause');
    const resetBtn = document.getElementById('reset');
    const speedRange = document.getElementById('speedRange');
    const speedLabel = document.getElementById('speedLabel');
    const loopCheckbox = document.getElementById('loop');
    const showCursor = document.getElementById('showCursor');
    const typeOnceBtn = document.getElementById('typeOnce');
    const eraseBtn = document.getElementById('erase');

    let speed = Number(speedRange.value);
    let isPlaying = false;
    let isPaused = false;
    let cancelToken = { cancel:false };

    speedRange.addEventListener('input', ()=>{
      speed = Number(speedRange.value);
      speedLabel.textContent = speed + ' ms';
    });

    showCursor.addEventListener('change', ()=>{
      cursor.style.display = showCursor.checked ? 'inline-block' : 'none';
    });

    function wait(ms){
      return new Promise(res => setTimeout(res, ms));
    }

    async function typeText(text, opts = {}){
      const {speed=50, cancelToken} = opts;
      output.textContent = '';
      isPlaying = true;
      isPaused = false;

      for(let i=0;i<text.length;i++){
        if(cancelToken.cancel) break;
        while(isPaused){ await wait(50); if(cancelToken.cancel) break; }
        output.textContent += text[i];
        output.parentElement.scrollTop = output.parentElement.scrollHeight;
        const jitter = Math.floor(Math.random()*Math.min(40,speed*0.4));
        await wait(speed + jitter);
      }
      isPlaying = false;
    }

    async function playLoop(){
      cancelToken.cancel = false;
      const text = inputText.value.replace(/\r/g,'');
      const doLoop = loopCheckbox.checked;
      do{
        await typeText(text, {speed, cancelToken});
        if(cancelToken.cancel) break;
        if(doLoop){
          await wait(600);
          for(let i=output.textContent.length;i>=0;i--){
            output.textContent = output.textContent.slice(0,i);
            await wait(Math.max(10, Math.floor(speed/3)));
            if(cancelToken.cancel) break;
          }
          await wait(200);
        }
      } while(doLoop && !cancelToken.cancel);
      isPlaying = false;
    }

    playBtn.addEventListener('click', ()=>{
      if(isPlaying){
        cancelToken.cancel = true;
        setTimeout(()=>{ cancelToken = {cancel:false}; playLoop(); }, 50);
      } else {
        cancelToken.cancel = false;
        playLoop();
      }
    });

    pauseBtn.addEventListener('click', ()=>{
      if(!isPlaying) return;
      isPaused = !isPaused;
      pauseBtn.textContent = isPaused ? '▶︎ Reprendre' : '⏸ Pause';
    });

    resetBtn.addEventListener('click', ()=>{
      cancelToken.cancel = true;
      isPaused = false;
      output.textContent = '';
      setTimeout(()=>{ cancelToken = {cancel:false}; }, 50);
    });

    typeOnceBtn.addEventListener('click', async ()=>{
      cancelToken.cancel = true;
      isPaused = false;
      output.textContent = '';
      setTimeout(async ()=>{
        cancelToken = {cancel:false};
        await typeText(inputText.value.replace(/\r/g,''), {speed, cancelToken});
      },50);
    });

    eraseBtn.addEventListener('click', async ()=>{
      cancelToken.cancel = true;
      isPaused = false;
      const current = output.textContent;
      for(let i=current.length;i>=0;i--){
        output.textContent = current.slice(0,i);
        await wait(Math.max(6, Math.floor(speed/4)));
      }
    });

    window.addEventListener('keydown', (e)=>{
      if(e.code === 'Space'){
        e.preventDefault();
        if(!isPlaying) playLoop(); else { isPaused = !isPaused; }
      }
    });

    cursor.style.display = showCursor.checked ? 'inline-block' : 'none';
  </script>
</body>
</html>